"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classPrivateFieldInitSpec(obj,privateMap,value){_checkPrivateRedeclaration(obj,privateMap),privateMap.set(obj,value)}function _checkPrivateRedeclaration(obj,privateCollection){if(privateCollection.has(obj))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateFieldGet(receiver,privateMap){var descriptor;return _classApplyDescriptorGet(receiver,_classExtractFieldDescriptor(receiver,privateMap,"get"))}function _classApplyDescriptorGet(receiver,descriptor){return descriptor.get?descriptor.get.call(receiver):descriptor.value}function _classPrivateFieldSet(receiver,privateMap,value){var descriptor;return _classApplyDescriptorSet(receiver,_classExtractFieldDescriptor(receiver,privateMap,"set"),value),value}function _classExtractFieldDescriptor(receiver,privateMap,action){if(!privateMap.has(receiver))throw new TypeError("attempted to "+action+" private field on non-instance");return privateMap.get(receiver)}function _classApplyDescriptorSet(receiver,descriptor,value){if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _index=new WeakMap,_prevented=new WeakMap,_history=new WeakMap,_preventBack=new WeakMap,_preventForward=new WeakMap,_override=new WeakMap,_listeners=new WeakMap,_id=new WeakMap,_lastPop=new WeakMap;class App{constructor(){var _history$state;_classPrivateFieldInitSpec(this,_index,{writable:!0,value:0}),_classPrivateFieldInitSpec(this,_prevented,{writable:!0,value:!1}),_classPrivateFieldInitSpec(this,_history,{writable:!0,value:[]}),_classPrivateFieldInitSpec(this,_preventBack,{writable:!0,value:0}),_classPrivateFieldInitSpec(this,_preventForward,{writable:!0,value:0}),_classPrivateFieldInitSpec(this,_override,{writable:!0,value:!1}),_classPrivateFieldInitSpec(this,_listeners,{writable:!0,value:[]}),_classPrivateFieldInitSpec(this,_id,{writable:!0,value:0}),_classPrivateFieldInitSpec(this,_lastPop,{writable:!0,value:"green"}),_defineProperty(this,"forceForward",internal=>{_classPrivateFieldSet(this,_override,internal||!0),history.go(1)}),_defineProperty(this,"forceBack",internal=>{_classPrivateFieldSet(this,_override,internal||!0),history.go(-1)}),_defineProperty(this,"replaceState",(url,data)=>(_classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)].state.url=url,_classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)].state.data=data,history.replaceState(_classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)],"",_classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)].state.url),this.state)),_defineProperty(this,"onPopState",fn=>{var _this$id;return _classPrivateFieldGet(this,_listeners).push({id:_classPrivateFieldSet(this,_id,(_this$id=_classPrivateFieldGet(this,_id),++_this$id)),fn:fn}),_classPrivateFieldGet(this,_id)}),_defineProperty(this,"offPopState",x=>{x?_classPrivateFieldGet(this,_listeners).splice(_classPrivateFieldGet(this,_listeners).map(v=>v.id).indexOf(x),1):_classPrivateFieldSet(this,_listeners,[])}),_defineProperty(this,"pushState",(url,data)=>{var _this$index;return _classPrivateFieldGet(this,_history)[_classPrivateFieldSet(this,_index,(_this$index=_classPrivateFieldGet(this,_index),++_this$index))]={index:_classPrivateFieldGet(this,_index),state:{url:url,scrollY:window.scrollY,scrollX:window.scrollX,data:data}},history.pushState(_classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)],"",url),this.state}),_classPrivateFieldSet(this,_index,isNaN(null===(_history$state=history.state)||void 0===_history$state?void 0:_history$state.index)?0:history.state.index),_classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)]=history.state||{index:_classPrivateFieldGet(this,_index),state:{url:location.pathname,scrollX:window.scrollX,scrollY:window.scrollY,data:{}}},window.addEventListener("scroll",()=>{try{_classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)].state.scrollX=window.scrollX,_classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)].state.scrollY=window.scrollY,history.replaceState(_classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)],"",_classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)].state.url)}catch{}}),window.addEventListener("popstate",e=>{var _e$state,_e$state$index,_e$state2,_e$state$state,_e$state3,_back=!1;if(null!==(_e$state=e.state)&&void 0!==_e$state&&_e$state.index?e.state.index<_classPrivateFieldGet(this,_index)?_back=!0:e.state.index>=_classPrivateFieldGet(this,_index)&&(_back=!1):_back=!0,_classPrivateFieldSet(this,_index,null!==(_e$state$index=null===(_e$state2=e.state)||void 0===_e$state2?void 0:_e$state2.index)&&void 0!==_e$state$index?_e$state$index:0),_back&&this.preventBack>0&&!1===_classPrivateFieldGet(this,_override))return _classPrivateFieldSet(this,_prevented,"back"),void this.forceForward(1);if(!_back&&this.preventForward>0&&!1===_classPrivateFieldGet(this,_override))return _classPrivateFieldSet(this,_prevented,"forward"),void this.forceBack(1);for(var listener of(_classPrivateFieldSet(this,_lastPop,{back:"back"===_classPrivateFieldGet(this,_prevented)||"forward"!==_classPrivateFieldGet(this,_prevented)&&!0===_back,forward:"forward"===_classPrivateFieldGet(this,_prevented)||"back"!==_classPrivateFieldGet(this,_prevented)&&!1===_back,prevented:!1!==_classPrivateFieldGet(this,_prevented),forced:!0===_classPrivateFieldGet(this,_override),state:null!==(_e$state$state=null===(_e$state3=e.state)||void 0===_e$state3?void 0:_e$state3.state)&&void 0!==_e$state$state?_e$state$state:{}}),_classPrivateFieldGet(this,_listeners)))listener.fn(_classPrivateFieldGet(this,_lastPop));_classPrivateFieldSet(this,_prevented,!1),_classPrivateFieldSet(this,_override,!1)})}get preventBack(){return _classPrivateFieldGet(this,_preventBack)>0}set preventBack(v){var _this$preventBack,_this$preventBack2,_this$preventBack3,_this$preventBack4;_classPrivateFieldSet(this,_preventBack,v?(_this$preventBack=_classPrivateFieldGet(this,_preventBack),_this$preventBack2=_this$preventBack++,_this$preventBack):(_this$preventBack3=_classPrivateFieldGet(this,_preventBack),_this$preventBack4=_this$preventBack3--,_this$preventBack3))}resetPreventBack(){_classPrivateFieldSet(this,_preventBack,0)}get preventForward(){return _classPrivateFieldGet(this,_preventForward)>0}set preventForward(v){var _this$preventForward,_this$preventForward2,_this$preventForward3,_this$preventForward4;_classPrivateFieldSet(this,_preventForward,v?(_this$preventForward=_classPrivateFieldGet(this,_preventForward),_this$preventForward2=_this$preventForward++,_this$preventForward):(_this$preventForward3=_classPrivateFieldGet(this,_preventForward),_this$preventForward4=_this$preventForward3--,_this$preventForward3))}resetPreventForward(){_classPrivateFieldSet(this,_preventForward,0)}get history(){return _classPrivateFieldGet(this,_history)}get state(){return _classPrivateFieldGet(this,_history)[_classPrivateFieldGet(this,_index)].state}get lastPop(){return _classPrivateFieldGet(this,_lastPop)}}var _default=new App;exports.default=_default;